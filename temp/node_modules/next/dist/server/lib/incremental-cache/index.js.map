{"version":3,"sources":["../../../../src/server/lib/incremental-cache/index.ts"],"names":["CacheHandler","IncrementalCache","toRoute","pathname","replace","constructor","_ctx","get","_key","_fetchCache","_fetchUrl","_fetchIdx","set","_data","revalidateTag","_tag","fs","dev","appDir","flushToDisk","fetchCache","minimalMode","serverDistDir","requestHeaders","requestProtocol","maxMemoryCacheSize","getPrerenderManifest","fetchCacheKeyPrefix","CurCacheHandler","allowedRevalidateHeaderKeys","debug","process","env","NEXT_PRIVATE_DEBUG_CACHE","console","log","FileSystemCache","FetchCache","name","__NEXT_TEST_MAX_ISR_CACHE","parseInt","prerenderManifest","revalidatedTags","PRERENDER_REVALIDATE_HEADER","preview","previewModeId","isOnDemandRevalidate","split","cacheHandler","_appDir","_requestHeaders","calculateRevalidate","fromTime","Date","getTime","initialRevalidateSeconds","routes","revalidateAfter","_getPathname","normalizePagePath","tag","fetchCacheKey","url","init","MAIN_KEY_PREFIX","cacheKey","bodyChunks","body","getReader","readableBody","reader","arrayBuffer","Uint8Array","processValue","done","value","push","encode","curBuffer","encodeText","prevBuffer","byteLength","err","error","read","then","_ogBody","keys","formData","key","Set","values","getAll","Promise","all","map","val","text","join","blob","Blob","type","cacheString","JSON","stringify","method","headers","Object","fromEntries","mode","redirect","credentials","referrer","referrerPolicy","integrity","cache","NEXT_RUNTIME","bufferToHex","buffer","Array","prototype","call","b","toString","padStart","crypto","subtle","digest","require","createHash","update","revalidate","fetchUrl","fetchIdx","cacheData","entry","kind","age","Math","round","now","lastModified","isStale","data","curRevalidate","CACHE_ONE_YEAR","undefined","notFoundRoutes","includes","revalidateSeconds","length","Error","dataRoute","path","posix","srcRoute","warn"],"mappings":"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"}